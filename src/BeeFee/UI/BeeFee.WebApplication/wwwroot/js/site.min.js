function eventsPageInit(n,t){if(typeof n!="undefined"&&n!=null&&n.length!==0){var i=0,f=10,r=!1,u=!1,e=function(n){if(!r&&!u){u=!0;var e=$("<div class='col-xs-4 col-md-12'>Загружаю события...<\/div>");i==0&&$(t).html("");$(t).append(e);Events.loadEvents($(n.searchtextselector).val(),$(n.enddateselector).val(),$(n.cityselector).val(),$(n.chkconcertselector).prop("checked"),$(n.chkexhibitionselector).prop("checked"),$(n.chkexcursionselector).prop("checked"),[],i,f,$(n.maxpriceselector).val()).done(function(n){n.length<f&&(r=!0);n.length>0?$.each(n,function(n,i){$(t).append('<div class="col-xs-4 col-md-4"><div class="grid--item"><a class="item" href="#"><span class="item--poster" style="background-image: url('+i.url+');"><\/span><span class="item--date">'+i.page.date+'<\/span><\/span><span class="item--title">'+i.page.caption+"<\/span ><\/a ><\/div ><\/div >")}):$(t).html("<div class='col-xs-4 col-md-12'>Событий не найдено<\/div>");i++;e.remove()}).fail(function(){$(t).html("<div class='col-xs-4 col-md-12'>Событий не найдено<\/div>")}).always(function(){u=!1})}};$.each(n,function(n,u){$(u.btnloadselector).click(function(){r=!1;i=0;$(t).html("");e(u)})});$(n[0].btnloadselector).click();$(window).scroll(function(){$(window).scrollTop()+$(window).height()==$(document).height()&&e()})}}function initFixedBox(){var n=$("div[data-fixed-wrap]>.container");n.length!=0&&(topFixed=n.offset().top+n.outerHeight(),prevTop=$(this).scrollTop(),prevShowTop=prevTop,$(window).scroll(function(){var n=$(this).scrollTop();if(n>prevTop||n<topFixed){$(".fixed-box").removeClass("is-shown");prevTop=n;return}n<prevTop&&(n>=topFixed&&n+2<prevTop&&($(".fixed-box").hasClass("is-shown")||$(".fixed-box").addClass("is-shown").slideDown(200)),prevTop=n);$(".fixed-box").hasClass("is-shown")||(prevTop=n)}))}var topFixed,prevTop=0,prevShowTop=0,Events;$(document).ready(function(){function n(n,t){var i="",r="";i+=t.getDate()+"/";i+=t.getMonth()+1+"/";i+=t.getFullYear();r+=t.getHours()<=9?"0"+t.getHours():t.getHours()+":";r+=t.getMinutes()<=9?"0"+t.getMinutes():t.getMinutes();n.find("span.is-s1").html(i);n.find("span.is-s2").html(r)}$('a[href="#"]').on({click:function(n){n.preventDefault()}});initLoginDialog();initFixedBox();$('[data-goto="filter"]').on({click:function(n){n.preventDefault();$("html, body").scrollTop($(".filter").offset().top-$('[data-fixed="header"]').outerHeight());$('[data-toggle="filter"]').addClass("is-active");$(".filter--body").slideDown(200,function(){$(this).is(":visible")&&$(this).find('input[type="text"]').first().focus()})}});$(".js-modals-close").on({click:function(n){n.preventDefault();$(".modals, .modals--item").fadeOut(200)}});$(".js-modals-open").on({click:function(n){n.preventDefault();var t=$(this).attr("modal-id");$(".modals").fadeIn(200);$(".modals--item#"+t).fadeIn(200,function(){$(this).find('input[type="text"]').first().focus()})}});$('[data-toggle="filter"]').on({click:function(n){n.preventDefault();$('[data-toggle="filter"]').toggleClass("is-active");$(".filter--body").slideToggle(200,function(){$(this).is(":visible")&&$(this).find('input[type="text"]').first().focus()})}});$(document).on("focus",".input-field",function(){$(this).addClass("with-focus")});$(document).on("blur",".input-field",function(){$(".input-field--i",this).val()===""&&$(this).removeClass("with-focus")});$(document).on("keyup",".input-field",function(){var n=$(this);n.removeClass("with-error");$(".input-field--i",this).val()!=""?n.addClass("with-value"):n.removeClass("with-value")});$(document).on("change",".input-field",function(){var n=$(this);n.removeClass("with-error");$(".input-field--i",this).val()!=""?n.addClass("with-value"):n.removeClass("with-value")});$(".vertical-field").each(function(){var n=$(this),t=$(this).find(".vertical-field--i");t.on({focus:function(){n.addClass("with-focus")},blur:function(){n.removeClass("with-focus")},keyup:function(){n.removeClass("with-error");$(this).val()!=""?n.addClass("with-value"):n.removeClass("with-value")}})});$(".select_in").on("click",function(){var n=$(this),t=n.closest(".select"),i=t.find(".select_list");i.is(":visible")?(i.slideUp(200),t.removeClass("is-opened"),n.find(".select_arrow").removeClass("is-active")):($(".select .select_list:visible").length&&($(".select .select_list:visible").hide(),$(".select .select_arrow").removeClass("is-active")),i.slideDown(200),t.addClass("is-opened"),n.find(".arrow").addClass("is-active"))});$(".select_list li").on("click",function(){var n=$(this),t=n.closest(".select").find(".select_in .select_title"),i=n.html();t.html(i);n.closest(".select").find("input[type=hidden]").val(n.attr("data-value"));n.closest(".select_list").find("li").removeClass("is-active");n.addClass("is-active");n.closest(".select_list").slideUp(200);n.closest(".select").removeClass("is-opened");n.closest(".select").find(".select_arrow").removeClass("is-active")});$(document).on("click",function(n){$(".select .select_list:visible").length&&!$(n.target).closest(".select").length&&($(".select").removeClass("is-opened"),$(".select .select_list").slideUp(200),$(".select .select_arrow").removeClass("is-active"))});$(document).keyup(function(n){n.keyCode==27&&($(".select").removeClass("is-opened"),$(".select .select_list").slideUp(200))});$('[data-step-nav="next"]').on("click",function(n){n.preventDefault();var t=$(".create--step.is-shown");t.removeClass("is-shown").addClass("is-saved");t.next().removeClass("is-saved").addClass("is-shown")});$('[data-step-nav="edit"]').on("click",function(n){n.preventDefault();var t=$(this).closest(".create--step");$(".create--step.is-shown").removeClass("is-shown");t.removeClass("is-saved").addClass("is-shown")});$(".wysiwyg-editor").length>0&&$(".wysiwyg-editor").each(function(){$(this).trumbowyg({lang:"ru"})});$(".create--file-i").on("change",function(){$(this).parent().find(".create--file-b").html($(this).val().split("\\").pop())});$.datetimepicker.setLocale("ru");$('[data-range="start"]').datetimepicker({onChangeDateTime:function(t,i){n(i.closest(".create--field-di"),t)}});$('[data-range="end"]').datetimepicker({onChangeDateTime:function(t,i){n(i.closest(".create--field-di"),t)}});$(".js-date").datetimepicker({timepicker:!1,format:"d.m.Y"});var t=$(".create--map-in"),i=function(n){typeof ymaps!="undefined"&&ymaps.ready(function(){n.each(function(){var n=new ymaps.Map(this,{center:[55.751244,37.618423],zoom:10})})})};t.length>0&&$.getScript("https://api-maps.yandex.ru/2.1/?lang=ru_RU",function(){i(t)});$('[data-checkboxes="total"]').on("change",function(){$(this).closest(".input-field--c, .vertical-field--c").find("input").prop("checked",$(this).prop("checked"))});$(".input-field--c input, .vertical-field--c input").on("change",function(){var n=!0,t=$(this).closest(".input-field--c, .vertical-field--c"),i=t.find('[data-checkboxes="total"]');t.find("input").not(i).each(function(){if($(this).prop("checked")==!1){n=!1;return}});i.prop("checked",n)})});Events={loadEvents:function(n,t,i,r,u,f,e,o,s,h,c){var l=$.Deferred();return $.ajax({url:"/event/loadevents",data:{Text:n,StartDate:t,EndDate:i,City:r,LoadConcert:u,LoadExhibition:f,LoadExcursion:e,Categories:o,PageIndex:s,PageSize:h,MaxPrice:c},cache:!1,success:function(n){l.resolve(n.events)},error:function(n,t){l.reject(n,t)}}),l.promise()}};