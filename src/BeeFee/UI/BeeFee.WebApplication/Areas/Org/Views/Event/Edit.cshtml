@using BeeFee.WebApplication.Infrastructure
@using BeeFee.WebApplication.Areas.Org.Models
@model BeeFee.WebApplication.Areas.Org.Models.UpdateEventModel
@{
    ViewData["Title"] = "Редактирование события - " + Model.Name;
}
<form asp-action="Edit" asp-controller="Event" asp-route-id="@Model.Id" method="post" class="form-horizontal">
    <div class="validation" asp-validation-summary="ModelOnly"></div>
    <input type="hidden" asp-for="CompanyId" />
    <input type="hidden" asp-for="Version" />
    <a asp-action="ToModerate" style="float: right;margin-top:-35px" class="btn-blue" asp-route-companyId="@Model.CompanyId" asp-route-id="@Model.Id" asp-route-version="@Model.Version">Опубликовать</a>
    <div class="create">
        @Html.Partial("_CreateOrUpdateEvent", Model)

    </div>


    <div class="form-group">
        @*<input type="submit" value="Save" class="btn" />*@
        
    </div>

    @*@if (Model.Comments.IsNotNull())
        {
            foreach (var comment in Model.Comments)
            {
                <hr />
                @comment
            }
        }*@
</form>

@section Scripts{

    <script type="text/javascript">
        $(function () {
            initCreateOrUpdateEventPage();

	        $("#File").change(function() {
		        var $this = $(this);
		        var fd = new FormData;
		        fd.append('file', $this.prop('files')[0]);
				fd.append('setting', 'event');
				fd.append('companyName', '@(Model.CompanyUrl)');
                fd.append('eventName', '@(Model.Url)');
		        $.ajax({
					url: '@(BeeFeeWebAppSettings.Instance.ImagesUrl)/api/home',
			        contentType: false,
			        processData: false,
			        dataType: 'json',
			        method: "POST",
			        data: fd,
					success: function (data) {
                        $('#errorUploadImage').remove();
						if (data.error != null) {
                            $this.parent().before("<span id='#errorUploadImage' class=error>"+data.error+"</span>");
							return;
                        }
                        $this.prev().prev().remove();
                        $this.parent().prepend("<img src='@(BeeFeeWebAppSettings.Instance.ImagesUrl)/min/@(Model.CompanyUrl)/@(Model.Url)/368x190/" + data.path + "' />");
				        $("#Cover").val(data.path);
			        }
		        });
	        });
        });
    </script>
}